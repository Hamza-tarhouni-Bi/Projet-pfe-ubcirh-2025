import React, { useState, useRef } from 'react';

const CardDemandeConge = () => {
  const [formData, setFormData] = useState({
    startDate: '',
    endDate: '',
    reason: '',
    type: 'cong√© pay√©',
    notes: '',
    medicalFile: null
  });
  
  const [submitted, setSubmitted] = useState(false);
  const [fileName, setFileName] = useState('');
  const fileInputRef = useRef(null);
  
  const styles = {
    container: {
      backgroundColor: '#f0f4f8',
      minHeight: '100vh',
      padding: '20px',
      fontFamily: '"Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',
      color: '#334155'
    },
   
    mainContent: {
      maxWidth: '1200px',
      margin: '0 auto',
      paddingTop: '8rem'
    },
    header: {
      textAlign: 'center',
      marginBottom: '40px',
      padding: '20px 0' 
    },
    title: {
      fontSize: '2.2rem', 
      fontWeight: '700',
      color: '#1e40af',
      margin: '0 0 10px 0',
      position: 'relative',
      display: 'inline-block',
      paddingBottom: '15px'
    },
    titleAfter: {
      content: '""',
      position: 'absolute',
      bottom: 0,
      left: '50%',
      transform: 'translateX(-50%)',
      width: '60%',
      height: '4px',
      background: 'linear-gradient(90deg, #1e40af, #3b82f6)',
      borderRadius: '2px'
    },
    subtitle: {
      fontSize: '17px',
      color: '#64748b',
      marginTop: '10px',
      margin: '0',
      letterSpacing: '0.3px'
    },
    formContainer: {
      backgroundColor: '#ffffff',
      borderRadius: '12px',
      padding: '35px',
      marginBottom: '35px',
      boxShadow: '0 4px 10px rgba(0,0,0,0.06)',
      border: '1px solid rgba(0,0,0,0.04)'
    },
    formHeader: {
      marginBottom: '25px',
      borderBottom: '1px solid #e2e8f0',
      paddingBottom: '15px'
    },
    formTitle: {
      fontSize: '22px',
      fontWeight: '700',
      color: '#1e40af',
      margin: '0 0 8px 0'
    },
    formDescription: {
      fontSize: '15px',
      color: '#64748b',
      margin: '0'
    },
    formGroup: {
      marginBottom: '20px'
    },
    label: {
      display: 'block',
      fontSize: '15px',
      fontWeight: '600',
      color: '#475569',
      marginBottom: '8px'
    },
    input: {
      width: '100%',
      padding: '12px 14px',
      border: '1px solid #e2e8f0',
      borderRadius: '8px',
      fontSize: '15px',
      boxShadow: '0 1px 2px rgba(0,0,0,0.04)',
      transition: 'all 0.2s ease'
    },
    formGrid: {
      display: 'grid',
      gridTemplateColumns: 'repeat(2, 1fr)',
      gap: '20px',
      marginBottom: '20px'
    },
    selectContainer: {
      position: 'relative'
    },
    select: {
      width: '100%',
      padding: '12px 14px',
      border: '1px solid #e2e8f0',
      borderRadius: '8px',
      fontSize: '15px',
      boxShadow: '0 1px 2px rgba(0,0,0,0.04)',
      transition: 'all 0.2s ease',
      appearance: 'none',
      paddingRight: '40px',
      backgroundColor: '#ffffff'
    },
    selectArrow: {
      position: 'absolute',
      right: '15px',
      top: '50%',
      transform: 'translateY(-50%)',
      color: '#64748b',
      pointerEvents: 'none',
      width: '12px',
      height: '12px',
      borderLeft: '2px solid #64748b',
      borderBottom: '2px solid #64748b',
      transform: 'translateY(-70%) rotate(-45deg)'
    },
    congeInfoTag: {
      display: 'block',
      fontSize: '14px',
      color: '#64748b',
      marginTop: '5px'
    },
    textarea: {
      width: '100%',
      padding: '12px 14px',
      border: '1px solid #e2e8f0',
      borderRadius: '8px',
      fontSize: '15px',
      boxShadow: '0 1px 2px rgba(0,0,0,0.04)',
      transition: 'all 0.2s ease',
      minHeight: '100px',
      resize: 'vertical'
    },
    alert: {
      backgroundColor: '#e0f2fe',
      borderRadius: '8px',
      padding: '14px',
      marginBottom: '20px',
      display: 'flex',
      alignItems: 'center',
      gap: '10px',
      boxShadow: '0 1px 2px rgba(0,0,0,0.04)'
    },
    alertIcon: {
      color: '#0369a1',
      fontSize: '18px'
    },
    alertText: {
      color: '#0369a1',
      fontSize: '15px',
      fontWeight: '500',
      margin: '0'
    },
    buttonContainer: {
      marginTop: '25px'
    },
    button: {
      width: '100%',
      padding: '14px',
      backgroundColor: '#2563eb',
      color: '#ffffff',
      border: 'none',
      borderRadius: '8px',
      fontSize: '16px',
      fontWeight: '600',
      cursor: 'pointer',
      transition: 'all 0.2s ease',
      boxShadow: '0 2px 5px rgba(37, 99, 235, 0.3)'
    },
    successAlert: {
      backgroundColor: '#dcfce7',
      borderRadius: '8px',
      padding: '18px',
      marginBottom: '30px',
      display: 'flex',
      alignItems: 'center',
      gap: '15px',
      boxShadow: '0 1px 3px rgba(0,0,0,0.05)'
    },
    successIcon: {
      color: '#16a34a',
      fontSize: '24px',
      fontWeight: 'bold'
    },
    successText: {
      color: '#166534',
      fontSize: '17px',
      fontWeight: '600',
      margin: '0'
    },
    summaryTitle: {
      fontSize: '28px',
      fontWeight: '700',
      color: '#1e40af',
      marginBottom: '25px',
      textAlign: 'center'
    },
    summaryCard: {
      backgroundColor: '#f8fafc',
      padding: '30px',
      borderRadius: '10px',
      marginBottom: '30px',
      border: '1px solid #e2e8f0',
      boxShadow: '0 2px 5px rgba(0,0,0,0.04)'
    },
    summaryGrid: {
      display: 'grid',
      gridTemplateColumns: 'repeat(2, 1fr)',
      gap: '20px'
    },
    summaryLabel: {
      fontSize: '14px',
      color: '#64748b',
      marginBottom: '6px',
      fontWeight: '500'
    },
    summaryValue: {
      fontSize: '16px',
      fontWeight: '600',
      color: '#334155'
    },
    colSpan2: {
      gridColumn: 'span 2'
    },
    fileInputContainer: {
      position: 'relative',
      display: 'flex',
      flexDirection: 'column',
      width: '100%'
    },
    fileInput: {
      position: 'absolute',
      top: 0,
      left: 0,
      opacity: 0,
      width: '100%',
      height: '100%',
      cursor: 'pointer'
    },
    fileInputLabel: {
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '12px 14px',
      border: '1px dashed #3b82f6',
      borderRadius: '8px',
      backgroundColor: '#f1f5f9',
      color: '#475569',
      fontSize: '15px',
      cursor: 'pointer',
      transition: 'all 0.2s ease',
      minHeight: '50px'
    },
    selectedFile: {
      display: 'flex',
      alignItems: 'center',
      gap: '10px',
      marginTop: '10px',
      padding: '10px',
      backgroundColor: '#f1f5f9',
      borderRadius: '6px',
      fontSize: '14px'
    },
    fileIcon: {
      fontSize: '20px',
      color: '#3b82f6'
    },
    fileInfo: {
      flex: 1,
      overflow: 'hidden',
      textOverflow: 'ellipsis',
      whiteSpace: 'nowrap'
    },
    removeButton: {
      background: 'none',
      border: 'none',
      color: '#ef4444',
      cursor: 'pointer',
      fontSize: '16px',
      padding: '0 5px'
    }
  };
  
  // Types de cong√©s avec des ic√¥nes - Version am√©lior√©e
  const congeTypes = [
    {
      type: 'cong√© pay√©',
      title: 'Cong√© Pay√© Standard',
      description: 'Cong√© annuel r√©mun√©r√©',
      remainingDays: 15,
      icon: 'üèñÔ∏è'
    },
    {
      type: 'rtt',
      title: 'RTT',
      description: 'R√©duction du temps de travail',
      remainingDays: 8,
      icon: '‚è±Ô∏è'
    },
    {
      type: 'cong√© maladie',
      title: 'Cong√© Maladie',
      description: 'Absence pour raison m√©dicale',
      remainingDays: 10,
      icon: 'üè•'
    },
    {
      type: 'cong√© parental',
      title: 'Cong√© Parental',
      description: 'Cong√© pour s\'occuper d\'un enfant',
      remainingDays: 'Selon droits',
      icon: 'üë∂'
    },
    {
      type: 'cong√© familial',
      title: '√âv√©nement Familial',
      description: 'Mariage, naissance, d√©c√®s',
      remainingDays: 'Selon √©v√©nement',
      icon: 'üë™'
    },
    {
      type: 'cong√© sans solde',
      title: 'Cong√© Sans Solde',
      description: 'Absence autoris√©e non r√©mun√©r√©e',
      remainingDays: 'Illimit√©',
      icon: 'üìÖ'
    },
    {
      type: 't√©l√©travail',
      title: 'T√©l√©travail Exceptionnel',
      description: 'Journ√©e de travail √† distance',
      remainingDays: 'Selon accord',
      icon: 'üè†'
    }
  ];

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prevData => ({
      ...prevData,
      [name]: value
    }));
  };
  
  const handleFileChange = (e) => {
    if (e.target.files && e.target.files[0]) {
      const file = e.target.files[0];
      setFormData(prev => ({
        ...prev,
        medicalFile: file
      }));
      setFileName(file.name);
    }
  };
  
  const removeFile = () => {
    setFormData(prev => ({
      ...prev,
      medicalFile: null
    }));
    setFileName('');
    if (fileInputRef.current) {
      fileInputRef.current.value = '';
    }
  };
  
  const handleSubmit = (e) => {
    e.preventDefault();
    
    // Validation pour cong√© maladie: fichier requis
    if (formData.type === 'cong√© maladie' && !formData.medicalFile) {
      alert('Veuillez joindre votre justificatif m√©dical');
      return;
    }
    
    setSubmitted(true);
  };
  
  const calculateDays = () => {
    if (!formData.startDate || !formData.endDate) return 0;
    
    const start = new Date(formData.startDate);
    const end = new Date(formData.endDate);
    const diffTime = Math.abs(end - start);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
    
    return diffDays;
  };

  // Trouver les informations du type de cong√© s√©lectionn√©
  const selectedCongeType = congeTypes.find(conge => conge.type === formData.type);
  const isMaladieType = formData.type === 'cong√© maladie';
  const needsJustification = ['cong√© maladie', 'cong√© familial'].includes(formData.type);
  
  return (
    <div style={styles.container}>
      <div style={styles.mainContent}>
        <div style={styles.header}>
          <h1 style={styles.title}>
            Demande de Cong√©
            <span style={styles.titleAfter}></span>
          </h1>
          <p style={styles.subtitle}>D√©couvrez et soumettez vos demandes de cong√©s en quelques clics</p>
        </div>

        {submitted ? (
          <div style={styles.formContainer}>
            <div style={styles.successAlert}>
              <span style={styles.successIcon}>‚úì</span>
              <p style={styles.successText}>
                Votre demande de cong√© a √©t√© soumise avec succ√®s!
              </p>
            </div>
            
            <h2 style={styles.summaryTitle}>R√©capitulatif de votre demande</h2>
            
            <div style={styles.summaryCard}>
              <div style={styles.summaryGrid}>
                <div>
                  <p style={styles.summaryLabel}>Type de cong√©</p>
                  <p style={styles.summaryValue}>
                    {selectedCongeType?.icon || ''} {selectedCongeType?.title || formData.type}
                  </p>
                </div>
                <div>
                  <p style={styles.summaryLabel}>Nombre de jours</p>
                  <p style={styles.summaryValue}>{calculateDays()} jours</p>
                </div>
                <div>
                  <p style={styles.summaryLabel}>Date de d√©but</p>
                  <p style={styles.summaryValue}>{new Date(formData.startDate).toLocaleDateString('fr-FR')}</p>
                </div>
                <div>
                  <p style={styles.summaryLabel}>Date de fin</p>
                  <p style={styles.summaryValue}>{new Date(formData.endDate).toLocaleDateString('fr-FR')}</p>
                </div>
                
                {isMaladieType ? (
                  <div style={styles.colSpan2}>
                    <p style={styles.summaryLabel}>Justificatif m√©dical</p>
                    <p style={styles.summaryValue}>{fileName || 'Fichier joint'}</p>
                  </div>
                ) : (
                  <div style={styles.colSpan2}>
                    <p style={styles.summaryLabel}>Motif</p>
                    <p style={styles.summaryValue}>{formData.reason}</p>
                  </div>
                )}
                
                {formData.notes && (
                  <div style={styles.colSpan2}>
                    <p style={styles.summaryLabel}>Notes compl√©mentaires</p>
                    <p style={styles.summaryValue}>{formData.notes}</p>
                  </div>
                )}
              </div>
            </div>
            
            <div style={{textAlign: 'center'}}>
              <button 
                onClick={() => setSubmitted(false)} 
                style={{...styles.button, maxWidth: '300px'}}
              >
                Nouvelle demande
              </button>
            </div>
          </div>
        ) : (
          <div style={styles.formContainer}>
            <div style={styles.formHeader}>
              <h2 style={styles.formTitle}>Formulaire de demande de cong√©</h2>
              <p style={styles.formDescription}>Veuillez remplir tous les champs obligatoires</p>
            </div>
            
            <form onSubmit={handleSubmit}>
              <div style={styles.formGroup}>
                <label style={styles.label} htmlFor="type">
                  Type de cong√©
                </label>
                <div style={styles.selectContainer}>
                  <select
                    id="type"
                    name="type"
                    value={formData.type}
                    onChange={handleChange}
                    style={styles.select}
                    required
                  >
                    {congeTypes.map((conge, index) => (
                      <option key={index} value={conge.type}>
                        {conge.icon} {conge.title}
                      </option>
                    ))}
                  </select>
                  <div style={styles.selectArrow}></div>
                </div>
                <span style={styles.congeInfoTag}>
                  {selectedCongeType?.description} - 
                  {typeof selectedCongeType?.remainingDays === 'number' 
                    ? ` ${selectedCongeType.remainingDays} jours disponibles` 
                    : ` ${selectedCongeType?.remainingDays}`}
                </span>
              </div>
              
              {/* Afficher un champ de t√©l√©chargement de fichier pour le cong√© maladie, sinon un champ de texte pour le motif */}
              {isMaladieType ? (
                <div style={styles.formGroup}>
                  <label style={styles.label} htmlFor="medicalFile">
                    Justificatif m√©dical *
                  </label>
                  <div style={styles.fileInputContainer}>
                    <label style={styles.fileInputLabel} htmlFor="medicalFile">
                      {formData.medicalFile ? 'Changer de fichier' : 'Joindre votre justificatif m√©dical'}
                    </label>
                    <input
                      type="file"
                      id="medicalFile"
                      ref={fileInputRef}
                      style={styles.fileInput}
                      accept=".pdf,.jpg,.jpeg,.png"
                      onChange={handleFileChange}
                      required
                    />
                  </div>
                  {formData.medicalFile && (
                    <div style={styles.selectedFile}>
                      <span style={styles.fileIcon}>üìÑ</span>
                      <span style={styles.fileInfo}>{fileName}</span>
                      <button 
                        type="button" 
                        style={styles.removeButton}
                        onClick={removeFile}
                      >
                        ‚úï
                      </button>
                    </div>
                  )}
                </div>
              ) : (
                <div style={styles.formGroup}>
                  <label style={styles.label} htmlFor="reason">
                    Motif {needsJustification && '*'}
                  </label>
                  <input
                    type="text"
                    id="reason"
                    name="reason"
                    value={formData.reason}
                    onChange={handleChange}
                    style={styles.input}
                    placeholder={needsJustification 
                      ? "Pr√©cisez le motif (obligatoire)" 
                      : "Pr√©cisez le motif de votre demande (facultatif)"}
                    required={needsJustification}
                  />
                </div>
              )}
              
              <div style={styles.formGrid}>
                <div style={styles.formGroup}>
                  <label style={styles.label} htmlFor="startDate">
                    Date de d√©but
                  </label>
                  <input
                    type="date"
                    id="startDate"
                    name="startDate"
                    value={formData.startDate}
                    onChange={handleChange}
                    style={styles.input}
                    required
                  />
                </div>
                
                <div style={styles.formGroup}>
                  <label style={styles.label} htmlFor="endDate">
                    Date de fin
                  </label>
                  <input
                    type="date"
                    id="endDate"
                    name="endDate"
                    value={formData.endDate}
                    onChange={handleChange}
                    style={styles.input}
                    required
                  />
                </div>
              </div>
              
              {formData.startDate && formData.endDate && (
                <div style={styles.alert}>
                  <span style={styles.alertIcon}>‚ÑπÔ∏è</span>
                  <p style={styles.alertText}>
                    Dur√©e: <strong>{calculateDays()} jours</strong>
                  </p>
                </div>
              )}
              
              <div style={styles.formGroup}>
                <label style={styles.label} htmlFor="notes">
                  Notes compl√©mentaires
                </label>
                <textarea
                  id="notes"
                  name="notes"
                  value={formData.notes}
                  onChange={handleChange}
                  style={styles.textarea}
                  placeholder="Informations additionnelles (facultatif)"
                />
              </div>
              
              <div style={styles.buttonContainer}>
                <button type="submit" style={styles.button}>
                  Soumettre la demande
                </button>
              </div>
            </form>
          </div>
        )}
      </div>
    </div>
  );
};

export default CardDemandeConge;